# Flags del compilador y de Valgrind.
CC := gcc
VALGRIND = valgrind --leak-check=full --track-origins=yes --show-reachable=yes --error-exitcode=2

ARCHIVOS = $(wildcard *.c)
ARCHIVOS_SIN_UNIT_TEST := $(filter-out unit_test.c, $(ARCHIVOS))
ARCHIVOS_SIN_MAIN := $(filter-out main.c, $(ARCHIVOS))

build: $(ARCHIVOS:.c=.o)
	$(CC) ${CFLAGS} -o main $^

run:
	./main

build_pre_unit_test: $(ARCHIVOS_SIN_UNIT_TEST)
	$(CC) -c $^


build_unit_test: $(ARCHIVOS_SIN_MAIN:.c=.o)
	$(CC) -o main $^ -lcriterion

run_unit_test:
	./main --json=unit_test_results_output.json --quiet --always-succeed

.PHONY: main clean